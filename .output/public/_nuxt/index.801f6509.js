import X from"./CBToggleSwitch.58227a55.js";import K from"./CBTextField.255ef873.js";import Q from"./CBTextArea.9d340382.js";import Y from"./CBFileInput.dee11c68.js";import{_ as Z}from"./backButton.b4a42b8e.js";import{_ as ee}from"./layout.11a375a8.js";import{G as ae,H as oe,a6 as te,J as se,a as e,_ as le,r as b,m as ie,R as re,E as ne,f as me,k as ue,j as q,U as ce,V as de,W as pe,X as ge,y as fe,z as he,o as L,c as B,w as i,e as V,t as be,u as o,b as ve,h as _e,F as ye,g as Se,d as ke,p as xe,i as Ce}from"./entry.94ffdeeb.js";import{u as Ae}from"./useRealmData.f000b3e2.js";import{V as E,a as v}from"./VRow.874663fa.js";import{a as Re,m as Le,e as Ve,u as Ie}from"./router.12029284.js";import{m as Ne,u as Te}from"./dimensions.2a8a239a.js";import{m as we,u as Pe}from"./VProgressLinear.7e39016e.js";import{m as Be,u as Ue}from"./position.048a6b63.js";import{m as $e,u as Fe}from"./rounded.a3340ae4.js";import{m as qe}from"./tag.6e0eec08.js";import{u as Ee}from"./color.08edc865.js";import{V as je}from"./VImg.9336a433.js";import{V as Me}from"./VCard.9eec5110.js";import{V as De}from"./VBtn.d2531af0.js";import{V as ze}from"./VSnackbar.f99cdf2a.js";import{V as He}from"./VIcon.a89c1bf3.js";import"./VSelectionControl.dc270e61.js";import"./density.5a2b29f1.js";import"./useRender.ee02d324.js";import"./index.5bd91e98.js";import"./VInput.6e31d692.js";import"./index.108b6c93.js";import"./transition.7408c173.js";import"./loader.0e188cc9.js";import"./VProgressCircular.6669da86.js";import"./resizeObserver.16ca977f.js";import"./VTextField.5390ceef.js";/* empty css                   */import"./forwardRefs.14bdb9d9.js";import"./index.66b8fb70.js";import"./VChip.c096698a.js";import"./group.e7d6c6fc.js";import"./VAvatar.7d2681a0.js";import"./useSiteStore.7e6abfbd.js";import"./createSimpleFunctional.433ad74c.js";import"./VOverlay.a8c9058d.js";import"./hydration.f2ecb7c8.js";const Ge=ae({name:"VSheet",props:{color:String,...Re(),...Ne(),...Le(),...we(),...Be(),...$e(),...qe(),...oe()},setup(l,u){let{slots:I}=u;const{themeClasses:N}=te(l),{backgroundColorClasses:c,backgroundColorStyles:_}=Ee(se(l,"color")),{borderClasses:p}=Ve(l),{dimensionStyles:g}=Te(l),{elevationClasses:f}=Ie(l),{locationStyles:T}=Pe(l),{positionClasses:w}=Ue(l),{roundedClasses:y}=Fe(l);return()=>e(l.tag,{class:["v-sheet",N.value,c.value,p.value,f.value,w.value,y.value],style:[_.value,g.value,T.value]},I)}}),Je=l=>(xe("data-v-33335893"),l=l(),Ce(),l),Oe={class:"text-h4 mb-3"},We={class:"d-flex align-center justify-center align-md-start"},Xe={class:"d-flex"},Ke=Je(()=>V("p",{class:"text-primary text-body-2"}," Upload Succeeded ",-1)),Qe={__name:"index",setup(l){const u=b({}),I=ie(),N=re(),c=b(!1),_=b([]),p=b(!1),g=b(!1),f=b(!1),T=ne();me(()=>{Ae(T.params.realm,{noMusic:!0}).then(({realmData:a})=>{u.value=a.value,_.value=[a.value.sigilImageLink],a.value.sigilImageLink&&(g.value=a.value.sigilImageLink||!1),a.value.audioLink&&(f.value=a.value.audioLink||!1),U({touched:!1,values:a.value})})});const w={title:"required|alphaAndSpace|min:5|max:20",abbTitle:"requiredAbbreviation:title,15|alphaSpaceAndDot|max:12",slug:"required|slug|min:3|max:20",narrative:"required|narrativeString|max:150",realmCode:"requiredIf:hasSemiotics",iconNames:"required"},{values:y,handleSubmit:j,errors:r,setFieldValue:M,meta:x,resetForm:U}=ue({initialValues:{hasSemiotics:!1,clearanceNeeded:!1,acceptingSubmissions:!1,title:"",abbTitle:"",narrative:"",iconNames:"",slug:"",realmSigil:[],realmAudio:[],realmCode:null,audioLicenseLink:null,audioAuthorLink:null,audioAuthorName:null},validationSchema:w}),$=async(a,t)=>{M(t,[a.target.files[0]]),t==="realmSigil"&&(_.value=[URL.createObjectURL(a.target.files[0])],g.value=!1),t==="realmAudio"&&(f.value=!1)},D=q(()=>{var a;return(a=y.iconNames)==null?void 0:a.split(",")}),z=q(()=>{var a;return((a=y.title)==null?void 0:a.length)>12?"Realm Name Truncation*":"Realm Name Truncation"}),H=()=>{U({touched:!1,values:u.value})},G=j(async a=>{var k,m;if(c.value||!x.value.dirty)return;c.value=!0;const t=[],h=(k=a==null?void 0:a.realmSigil)!=null&&k.length?{inputType:"sigil",file:a.realmSigil[0],storageRef:`${u.value.slug}/sigil`}:null,n=(m=a==null?void 0:a.realmAudio)!=null&&m.length?{inputType:"audio",file:a.realmAudio[0],storageRef:`${u.value.slug}/audio`}:null;let C=[h,n].filter(s=>s);C.length>=0&&C.map(s=>{const J=new Promise((P,O)=>{if((s==null?void 0:s.inputType)==="sigil"&&g.value)P({sigil:g.value});else if((s==null?void 0:s.inputType)==="audio"&&f.value)P({audio:f.value});else{const W=ce(N,s.storageRef),F=de(W,s.file);F.on("state_changed",null,R=>{O(R),alert(R)},()=>{pe(F.snapshot.ref).then(R=>{P({[s.inputType]:R})})})}});t.push(J)});const A=await Promise.all(t);let d={};A.forEach(s=>{d={...d,...s}});const S={...a,sigilImageLink:d.sigil||null,audioLink:d.audio||null,lastUpdated:ge()};delete S.realmSigil,delete S.realmAudio,fe(he(I,"realms",u.value.slug),{...S},{merge:!0}).then(()=>{p.value=!0,c.value=!1})});return(a,t)=>{const h=X,n=K,C=Q,A=Y,d=Z,S=ee;return L(),B(S,{name:"realm-editing"},{default:i(()=>{var k;return[V("h4",Oe,be((k=u.value)==null?void 0:k.title)+" Data",1),e(Me,{variant:"outlined",color:"primary-darken-1",class:"pa-15 text-primary mb-15"},{default:i(()=>[e(E,null,{default:i(()=>[e(v,{cols:"12",md:"12",class:"mb-5 text-primary"},{default:i(()=>[V("div",We,[e(h,{name:"hasSemiotics",label:"Has Semiotics"}),e(h,{name:"clearanceNeeded",label:"Clearance Needed"}),e(h,{name:"takingSubmissions",label:"Accepting Submissions"})])]),_:1})]),_:1}),e(E,null,{default:i(()=>[e(v,{cols:"12",md:"6",class:"mb-5 text-primary"},{default:i(()=>[e(n,{class:"mb-5",name:"title",errors:o(r).title,hint:"A proper noun case name for the realm.",label:"Realm Name*"},null,8,["errors"]),e(n,{class:"mb-5",name:"abbTitle",errors:o(r).abbTitle,hint:"A truncation to use in place of longer realm names. e.g. Agg. Lagoon, Inhb. Realm",label:o(z)},null,8,["errors","label"]),e(n,{class:"mb-5",name:"subtitle",errors:o(r).subtitle,hint:"An adjective then noun works well here, e.g. Bountiful Archeology ",label:"Realm Subtitle*"},null,8,["errors"]),e(Ge,{class:"text-primary mb-2 d-flex align-center justify-start",height:"30px"},{default:i(()=>[(L(!0),ve(ye,null,_e(o(D),(m,s)=>(L(),B(He,{size:"25px",class:"mr-2",key:`icon${s}`,icon:`mdi-${m}`},null,8,["icon"]))),128))]),_:1}),e(n,{class:"mb-5",name:"iconNames",errors:o(r).iconNames,hint:"Comma separated values of Material Design Icon names. If the icons display above your input is valid.",label:"Realm Icons*"},null,8,["errors"]),o(y).hasSemiotics?(L(),B(n,{key:0,class:"mb-5",name:"realmCode",errors:o(r).realmCode,hint:"If a realm has Semiotics it requires a 4 digit code comprised of 0 to 9, *, and # ",label:"Realm Code*"},null,8,["errors"])):Se("",!0)]),_:1}),e(v,{cols:"12",md:"6",class:"text-primary"},{default:i(()=>[e(n,{class:"mb-5",name:"slug",errors:o(r).slug,hint:"A hyphenated URL path, lowercase letters & hyphens only. e.g. silent-shores",label:"Realm Slug*"},null,8,["errors"]),e(C,{class:"mb-5",name:"narrative",label:"Realm Narrative*",hint:"Should be musing information about the realm. Two short sentences or sentence fragments are appropriate.",errors:o(r).narrative},null,8,["errors"]),V("div",Xe,[e(A,{class:"mb-5 mr-4",errors:o(r).realmSigil,hint:"Upload an image representing one of the existing realms.",label:"Realm Sigil",name:"realmSigil",onChange:t[0]||(t[0]=m=>$(m,"realmSigil"))},null,8,["errors"]),e(je,{class:"abberation mb-8",contain:"","max-width":"100px",src:_.value[0],alt:"geometric shape"},null,8,["src"])]),e(A,{class:"mb-5",errors:o(r).realmAudio,hint:"Upload a looping audio file in MP3 format which will play when viewing the realm.",label:"Realm Audio",name:"realmAudio",onChange:t[1]||(t[1]=m=>$(m,"realmAudio"))},null,8,["errors"]),e(n,{class:"mb-5",name:"audioLicenseLink",errors:o(r).audioLicenseLink,hint:"Input a url to the CC License if sourced from somewhere requiring attribution.",label:"Audio License URL"},null,8,["errors"]),e(n,{class:"mb-5",name:"audioAuthorLink",errors:o(r).audioAuthorLink,hint:"Input a url to the original audio posted by the audio author if sourced from somewhere requiring attribution.",label:"Audio Author URL"},null,8,["errors"]),e(n,{class:"mb-5",name:"audioAuthorName",errors:o(r).audioAuthorName,hint:"Input the name of the author if sourced from somewhere requiring attribution.",label:"Audio Author Name"},null,8,["errors"])]),_:1}),e(v,{cols:"12",md:"4",class:"text-primary"},{default:i(()=>[e(h,{name:"isPublished",label:"Is Published"})]),_:1}),e(v,{cols:"12",md:"4"},{default:i(()=>[e(d,{class:"mr-2 mb-3",variant:"outlined",text:"Undo Edits",rounded:"","realm-icons":["undo"],disabled:!o(x).dirty||c.value,loading:c.value,onClick:H},null,8,["disabled","loading"])]),_:1}),e(v,{cols:"12",md:"4"},{default:i(()=>[e(d,{class:"mr-2",rounded:"",variant:"elevated",text:o(x).dirty?"Save Changes":"No Changes Made",caution:c.value||!o(x).dirty,"realm-icons":["floppy"],onClick:o(G)},null,8,["text","caution","onClick"])]),_:1})]),_:1})]),_:1}),e(ze,{modelValue:p.value,"onUpdate:modelValue":t[3]||(t[3]=m=>p.value=m)},{actions:i(()=>[e(De,{color:"primary",variant:"text",onClick:t[2]||(t[2]=m=>p.value=!1)},{default:i(()=>[ke(" Close ")]),_:1})]),default:i(()=>[Ke]),_:1},8,["modelValue"])]}),_:1})}}},ja=le(Qe,[["__scopeId","data-v-33335893"]]);export{ja as default};
