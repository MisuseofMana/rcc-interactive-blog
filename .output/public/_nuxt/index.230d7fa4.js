import X from"./CBToggleSwitch.d3379471.js";import K from"./CBTextField.635aa0b5.js";import Q from"./CBTextArea.10efc8fb.js";import Y from"./CBFileInput.bbd49928.js";import{_ as Z}from"./backButton.3ed8edb3.js";import{_ as ee}from"./layout.e323096b.js";import{G as ae,H as oe,a6 as te,J as se,a as e,_ as le,r as b,m as ie,R as re,E as ne,f as me,k as ue,j as q,U as de,V as ce,W as pe,X as fe,v as ge,x as he,o as L,c as B,w as i,e as V,t as be,u as o,b as ve,h as _e,F as ye,g as Se,d as ke,p as xe,i as Ce}from"./entry.af4b25f0.js";import{u as Ae}from"./useRealmData.6d2e9fe7.js";import{V as E,a as v}from"./VRow.afde100a.js";import{a as Re,m as Le,b as Ve,u as Ie}from"./elevation.c0c3c7d4.js";import{m as Ne,u as Te}from"./dimensions.85878954.js";import{m as we,u as Pe}from"./VProgressLinear.58e0b888.js";import{m as Be,u as Ue}from"./position.6ecf00cf.js";import{m as $e,u as Fe}from"./rounded.2773415e.js";import{m as qe}from"./tag.622ed0d5.js";import{u as Ee}from"./color.16bf09b2.js";import{V as je}from"./VImg.732dd834.js";import{V as Me}from"./VCard.1acd0fd0.js";import{V as De}from"./VBtn.b508a718.js";import{V as He}from"./VSnackbar.96a565f4.js";import{V as ze}from"./VIcon.4c30e4d0.js";import"./VSelectionControl.a37bcff4.js";import"./density.a43ed496.js";import"./useRender.711bb119.js";import"./index.8efa490c.js";import"./VInput.6cafeb98.js";import"./index.72f797fd.js";import"./transition.c0b5a353.js";import"./loader.a28a0d31.js";import"./VProgressCircular.a0eacb68.js";import"./resizeObserver.f5995fd7.js";import"./VTextField.6cbfc730.js";/* empty css                   */import"./forwardRefs.a44f5a39.js";import"./index.26545022.js";import"./VChip.b3e2a517.js";import"./group.2a175b20.js";import"./router.4d4a04cb.js";import"./VAvatar.1cb02f40.js";import"./useSiteStore.bfcdeead.js";import"./createSimpleFunctional.e260b764.js";import"./VOverlay.400edcb4.js";import"./hydration.80aaf091.js";const Ge=ae({name:"VSheet",props:{color:String,...Re(),...Ne(),...Le(),...we(),...Be(),...$e(),...qe(),...oe()},setup(l,u){let{slots:I}=u;const{themeClasses:N}=te(l),{backgroundColorClasses:d,backgroundColorStyles:_}=Ee(se(l,"color")),{borderClasses:p}=Ve(l),{dimensionStyles:f}=Te(l),{elevationClasses:g}=Ie(l),{locationStyles:T}=Pe(l),{positionClasses:w}=Ue(l),{roundedClasses:y}=Fe(l);return()=>e(l.tag,{class:["v-sheet",N.value,d.value,p.value,g.value,w.value,y.value],style:[_.value,f.value,T.value]},I)}}),Je=l=>(xe("data-v-83ce2d90"),l=l(),Ce(),l),Oe={class:"text-h4 mb-3"},We={class:"d-flex align-center justify-center align-md-start"},Xe={class:"d-flex"},Ke=Je(()=>V("p",{class:"text-primary text-body-2"}," Upload Succeeded ",-1)),Qe={__name:"index",setup(l){const u=b({}),I=ie(),N=re(),d=b(!1),_=b([]),p=b(!1),f=b(!1),g=b(!1),T=ne();me(()=>{Ae(T.params.realm,{noMusic:!0}).then(({realmData:a})=>{u.value=a.value,_.value=[a.value.sigilImageLink],a.value.sigilImageLink&&(f.value=a.value.sigilImageLink||!1),a.value.audioLink&&(g.value=a.value.audioLink||!1),U({touched:!1,values:a.value})})});const w={title:"required|alphaAndSpace|min:5|max:20",abbTitle:"requiredAbbreviation:title,15|alphaSpaceAndDot|max:12",slug:"required|slug|min:3|max:20",narrative:"required|narrativeString|max:150",realmCode:"requiredIf:hasSemiotics",iconNames:"required"},{values:y,handleSubmit:j,errors:r,setFieldValue:M,meta:x,resetForm:U}=ue({initialValues:{hasSemiotics:!1,clearanceNeeded:!1,acceptingSubmissions:!1,title:"",abbTitle:"",narrative:"",iconNames:"",slug:"",realmSigil:[],realmAudio:[],realmCode:null,audioLicenseLink:null,audioAuthorLink:null,audioAuthorName:null},validationSchema:w}),$=async(a,t)=>{M(t,[a.target.files[0]]),t==="realmSigil"&&(_.value=[URL.createObjectURL(a.target.files[0])],f.value=!1),t==="realmAudio"&&(g.value=!1)},D=q(()=>{var a;return(a=y.iconNames)==null?void 0:a.split(",")}),H=q(()=>{var a;return((a=y.title)==null?void 0:a.length)>12?"Realm Name Truncation*":"Realm Name Truncation"}),z=()=>{U({touched:!1,values:u.value})},G=j(async a=>{var k,m;if(d.value||!x.value.dirty)return;d.value=!0;const t=[],h=(k=a==null?void 0:a.realmSigil)!=null&&k.length?{inputType:"sigil",file:a.realmSigil[0],storageRef:`${u.value.slug}/sigil`}:null,n=(m=a==null?void 0:a.realmAudio)!=null&&m.length?{inputType:"audio",file:a.realmAudio[0],storageRef:`${u.value.slug}/audio`}:null;let C=[h,n].filter(s=>s);C.length>=0&&C.map(s=>{const J=new Promise((P,O)=>{if((s==null?void 0:s.inputType)==="sigil"&&f.value)P({sigil:f.value});else if((s==null?void 0:s.inputType)==="audio"&&g.value)P({audio:g.value});else{const W=de(N,s.storageRef),F=ce(W,s.file);F.on("state_changed",null,R=>{O(R),alert(R)},()=>{pe(F.snapshot.ref).then(R=>{P({[s.inputType]:R})})})}});t.push(J)});const A=await Promise.all(t);let c={};A.forEach(s=>{c={...c,...s}});const S={...a,sigilImageLink:c.sigil||null,audioLink:c.audio||null,lastUpdated:fe()};delete S.realmSigil,delete S.realmAudio,ge(he(I,"realms",u.value.slug),{...S},{merge:!0}).then(()=>{p.value=!0,d.value=!1})});return(a,t)=>{const h=X,n=K,C=Q,A=Y,c=Z,S=ee;return L(),B(S,{name:"realm-editing"},{default:i(()=>{var k;return[V("h4",Oe,be((k=u.value)==null?void 0:k.title)+" Data",1),e(Me,{variant:"outlined",color:"primary-darken-1",class:"pa-15 text-primary mb-15"},{default:i(()=>[e(E,null,{default:i(()=>[e(v,{cols:"12",md:"12",class:"mb-5 text-primary"},{default:i(()=>[V("div",We,[e(h,{name:"hasSemiotics",label:"Has Semiotics"}),e(h,{name:"clearanceNeeded",label:"Clearance Needed"}),e(h,{name:"takingSubmissions",label:"Accepting Submissions"})])]),_:1})]),_:1}),e(E,null,{default:i(()=>[e(v,{cols:"12",md:"6",class:"mb-5 text-primary"},{default:i(()=>[e(n,{class:"mb-5",name:"title",errors:o(r).title,hint:"A proper noun case name for the realm.",label:"Realm Name*"},null,8,["errors"]),e(n,{class:"mb-5",name:"abbTitle",errors:o(r).abbTitle,hint:"A truncation to use in place of longer realm names. e.g. Agg. Lagoon, Inhb. Realm",label:o(H)},null,8,["errors","label"]),e(n,{class:"mb-5",name:"subtitle",errors:o(r).subtitle,hint:"An adjective then noun works well here, e.g. Bountiful Archeology ",label:"Realm Subtitle*"},null,8,["errors"]),e(Ge,{class:"text-primary mb-2 d-flex align-center justify-start",height:"30px"},{default:i(()=>[(L(!0),ve(ye,null,_e(o(D),(m,s)=>(L(),B(ze,{size:"25px",class:"mr-2",key:`icon${s}`,icon:`mdi-${m}`},null,8,["icon"]))),128))]),_:1}),e(n,{class:"mb-5",name:"iconNames",errors:o(r).iconNames,hint:"Comma separated values of Material Design Icon names. If the icons display above your input is valid.",label:"Realm Icons*"},null,8,["errors"]),o(y).hasSemiotics?(L(),B(n,{key:0,class:"mb-5",name:"realmCode",errors:o(r).realmCode,hint:"If a realm has Semiotics it requires a 4 digit code comprised of 0 to 9, *, and # ",label:"Realm Code*"},null,8,["errors"])):Se("",!0)]),_:1}),e(v,{cols:"12",md:"6",class:"text-primary"},{default:i(()=>[e(n,{class:"mb-5",name:"slug",errors:o(r).slug,hint:"A hyphenated URL path, lowercase letters & hyphens only. e.g. silent-shores",label:"Realm Slug*"},null,8,["errors"]),e(C,{class:"mb-5",name:"narrative",label:"Realm Narrative*",hint:"Should be musing information about the realm. Two short sentences or sentence fragments are appropriate.",errors:o(r).narrative},null,8,["errors"]),V("div",Xe,[e(A,{class:"mb-5 mr-4",errors:o(r).realmSigil,hint:"Upload an image representing one of the existing realms.",label:"Realm Sigil",name:"realmSigil",onChange:t[0]||(t[0]=m=>$(m,"realmSigil"))},null,8,["errors"]),e(je,{class:"abberation mb-8",contain:"","max-width":"100px",src:_.value[0],alt:"geometric shape"},null,8,["src"])]),e(A,{class:"mb-5",errors:o(r).realmAudio,hint:"Upload a looping audio file in MP3 format which will play when viewing the realm.",label:"Realm Audio",name:"realmAudio",onChange:t[1]||(t[1]=m=>$(m,"realmAudio"))},null,8,["errors"]),e(n,{class:"mb-5",name:"audioLicenseLink",errors:o(r).audioLicenseLink,hint:"Input a url to the CC License if sourced from somewhere requiring attribution.",label:"Audio License URL"},null,8,["errors"]),e(n,{class:"mb-5",name:"audioAuthorLink",errors:o(r).audioAuthorLink,hint:"Input a url to the original audio posted by the audio author if sourced from somewhere requiring attribution.",label:"Audio Author URL"},null,8,["errors"]),e(n,{class:"mb-5",name:"audioAuthorName",errors:o(r).audioAuthorName,hint:"Input the name of the author if sourced from somewhere requiring attribution.",label:"Audio Author Name"},null,8,["errors"])]),_:1}),e(v,{cols:"12",md:"4",class:"text-primary"},{default:i(()=>[e(h,{name:"isPublished",label:"Is Published"})]),_:1}),e(v,{cols:"12",md:"4"},{default:i(()=>[e(c,{class:"mr-2 mb-3",variant:"outlined",text:"Undo Edits",rounded:"","realm-icons":["undo"],disabled:!o(x).dirty||d.value,loading:d.value,onClick:z},null,8,["disabled","loading"])]),_:1}),e(v,{cols:"12",md:"4"},{default:i(()=>[e(c,{class:"mr-2",rounded:"",caution:!1,variant:"elevated",text:o(x).dirty?"Save Changes":"No Changes Made",disabled:d.value||!o(x).dirty,"realm-icons":["floppy"],onClick:o(G)},null,8,["text","disabled","onClick"])]),_:1})]),_:1})]),_:1}),e(He,{modelValue:p.value,"onUpdate:modelValue":t[3]||(t[3]=m=>p.value=m)},{actions:i(()=>[e(De,{color:"primary",variant:"text",onClick:t[2]||(t[2]=m=>p.value=!1)},{default:i(()=>[ke(" Close ")]),_:1})]),default:i(()=>[Ke]),_:1},8,["modelValue"])]}),_:1})}}},Ma=le(Qe,[["__scopeId","data-v-83ce2d90"]]);export{Ma as default};
